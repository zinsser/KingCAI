package com.android.test;  import java.io.BufferedOutputStream;  import java.io.DataInputStream;  import java.io.DataOutputStream;  import java.io.FileOutputStream;  import java.io.IOException;  import android.app.Activity;  import android.os.Bundle;  import android.util.Log;  import android.view.View;  import android.view.View.OnClickListener;  import android.widget.Button;  public class Main extends Activity implements OnClickListener{      private ClientSocket cs = null;      private static final String FILE_PATH = "/mnt/sdcard/";      private String ip = "192.168.1.103";      private int port = 8821;      private String sendMessage = "Linux";      private Button mButton;      @Override      public void onCreate(Bundle savedInstanceState) {          super.onCreate(savedInstanceState);          setContentView(R.layout.main);          mButton = (Button)findViewById(R.id.start);          mButton.setOnClickListener(this);      }      private void start() {          if (createConnection()) {              sendMessage();              getMessage();          }      }      private void getMessage() {          if (cs == null)              return;          DataInputStream inputStream = null;          inputStream = cs.getMessageStream();          try {              String savePath = FILE_PATH;              int bufferSize = 8192;              byte[] buf = new byte[bufferSize];              int passedlen = 0;              long len = 0;                            savePath += inputStream.readUTF();              Log.d("AndroidClient","@@@savePath"+savePath);              DataOutputStream fileOut = new DataOutputStream(                      new BufferedOutputStream(new BufferedOutputStream(                              new FileOutputStream(savePath))));              len = inputStream.readLong();              Log.d("AndoridClient","文件的长度为:"+len);              Log.d("AndroidClient","开始接收文件");              while(true) {                  int read = 0;                  if (inputStream != null) {                      read = inputStream.read(buf);                  }                  passedlen += read;                  if (read == -1) {                      break;                  }                  Log.d("AndroidClient","文件接收了"+(passedlen*100/len)+"%/n");                  fileOut.write(buf,0,read);              }              Log.d("AndroidClient","@@@文件接收完成"+savePath);              fileOut.close();          } catch (IOException e) {              // TODO Auto-generated catch block              e.printStackTrace();          }      }      private void sendMessage() {          if (cs == null)              return;          cs.sendMessage(sendMessage);      }      private boolean createConnection() {          cs = new ClientSocket(ip, port);          cs.createConnection();          Log.d("Main", "连接服务器成功:");          return true;      }      public void onClick(View v) {          start();      }  }  